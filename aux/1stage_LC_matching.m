%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% @date        : Mon Mar 19 15:38:35 CEST 2018
% @author(s)   : Francesco Urbani
% @file        : 1-stage_LC_matching.m
% @descritpion : Matlab calculations for 1 stage LC matching networks
%                Step-down (shunt-series) and step-up (series-shunt) conversions.
%                
%                RF Electronics class, Spring 2018
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


syms R_1 real
syms X_1 real

syms R_2 real
syms X_2 real

syms X real
syms B real




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%  shunt - series  %%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
%                                jX
%                            +--------+
%             +-----------+--+        +----+
%             |           |  +--------+
%             |           |
%             |           |
%            +++         +++
% Z_1 =      | |         | | jB          Z_2 = R_2 + jX_2
% R_1 + jX_1 | |         | |
%            +++         +++
%             |           |
%             |           |
%             |           |
%             +-----------+----------------+



% equivalent impedance
Z_2 = j*X + 1/(j*B + 1/(R_1+j*X_1))
 

real(Z_2)
pretty(ans)
%                           R_1
% -------------------------------------------------------
% /         2                             \
% |      R_1         /         X_1     \2 |     2      2
% | -------------- + | B - ----------- |  | (R_1  + X_1 )
% |     2      2 2   |        2      2 |  |
% \ (R_1  + X_1 )    \     R_1  + X_1  /  /



imag(Z_2)
pretty(ans)
%                        X_1
%                B - -----------
%                       2      2
%                    R_1  + X_1
% X - -------------------------------------
%             2
%          R_1         /         X_1     \2
%     -------------- + | B - ----------- |
%         2      2 2   |        2      2 |
%     (R_1  + X_1 )    \     R_1  + X_1  /




eq1 = real(Z_2) == R_2 
eq2 = imag(Z_2) == X_2
 
S=solve(eq1,eq2, X,B)

S.X
% (R_2*(X_1 - ((R_1*(R_1^2 - R_2*R_1 + X_1^2))/R_2)^(1/2)))/R_1 - (R_1*X_2 + R_2*X_1)/R_1
% (R_2*(X_1 + ((R_1*(R_1^2 - R_2*R_1 + X_1^2))/R_2)^(1/2)))/R_1 - (R_1*X_2 + R_2*X_1)/R_1


S.B
% (X_1 - ((R_1*(R_1^2 - R_2*R_1 + X_1^2))/R_2)^(1/2))/(R_1^2 + X_1^2)
% (X_1 + ((R_1*(R_1^2 - R_2*R_1 + X_1^2))/R_2)^(1/2))/(R_1^2 + X_1^2)


pretty(S.X)
% /                        2                         2            \
% |                     R_1  R_2 (X_1 + #2)   R_2 X_1  (X_1 + #2) |
% | R_1 X_2 - R_2 X_1 + ------------------- + ------------------- |
% |                              #1                    #1         |
% | ------------------------------------------------------------- |
% |                              R_1                              |
% |                                                               |
% |                        2                         2            |
% |                     R_1  R_2 (X_1 - #2)   R_2 X_1  (X_1 - #2) |
% | R_1 X_2 - R_2 X_1 + ------------------- + ------------------- |
% |                              #1                    #1         |
% | ------------------------------------------------------------- |
% \                              R_1                              /

% where

%             2      2
%    #1 == R_1  + X_1

%              /         2                2  \
%              | R_1 (R_1  - R_2 R_1 + X_1 ) |
%    #2 == sqrt| --------------------------- |
%              \             R_2             /



pretty(S.B)
% /           /         2                2  \ \
% |           | R_1 (R_1  - R_2 R_1 + X_1 ) | |
% | X_1 + sqrt| --------------------------- | |
% |           \             R_2             / |
% | ----------------------------------------- |
% |                   2      2                |
% |                R_1  + X_1                 |
% |                                           |
% |           /         2                2  \ |
% |           | R_1 (R_1  - R_2 R_1 + X_1 ) | |
% | X_1 - sqrt| --------------------------- | |
% |           \             R_2             / |
% | ----------------------------------------- |
% |                   2      2                |
% \                R_1  + X_1                 /




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%







clc
clear

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%  series - shunt  %%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%                       jX
%                      +--------+
%              +-------+        +----+--------------+
%              |       +--------+    |
%              |                     |
%              |                     |
%             +++                   +++
% Z_1 =       | |                   | | jB          Z_2 = R_2 + jX_2
% R_1 + jX_ 1 | |                   | |
%             +++                   +++
%              |                     |
%              |                     |
%              |                     |
%              +---------------------+---------------+


 
 
Z_2 = 1/(j*B + 1/(R_1+j*(X+X_1)))
 
real(Z_2)
pretty(ans)
%                                    R_1
% -------------------------------------------------------------------------
%                     /                                         2         \
%           2      2  | /          X + X_1      \2           R_1          |
% ((X + X_1)  + R_1 ) | | B - ----------------- |  + -------------------- |
%                     | |              2      2 |              2      2 2 |
%                     \ \     (X + X_1)  + R_1  /    ((X + X_1)  + R_1 )  /


imag(Z_2)
pretty(ans)
%                          X + X_1
%                 B - -----------------
%                              2      2
%                     (X + X_1)  + R_1
% - -------------------------------------------------
%                                           2
%   /          X + X_1      \2           R_1
%   | B - ----------------- |  + --------------------
%   |              2      2 |              2      2 2
%   \     (X + X_1)  + R_1  /    ((X + X_1)  + R_1 )

 



eq1 = real(Z_2) == R_2
eq2 = imag(Z_2) == X_2


S=solve(eq1,eq2, X,B)

S.X
% -(R_2*X_1 - R_1*X_2 + (R_1*R_2^2*(X_2 + ((R_2*(R_2^2 - R_1*R_2 + X_2^2))/R_1)^(1/2)))/(R_2^2 + X_2^2) + (R_1*X_2^2*(X_2 + ((R_2*(R_2^2 - R_1*R_2 + X_2^2))/R_1)^(1/2)))/(R_2^2 + X_2^2))/R_2
% -(R_2*X_1 - R_1*X_2 + (R_1*R_2^2*(X_2 - ((R_2*(R_2^2 - R_1*R_2 + X_2^2))/R_1)^(1/2)))/(R_2^2 + X_2^2) + (R_1*X_2^2*(X_2 - ((R_2*(R_2^2 - R_1*R_2 + X_2^2))/R_1)^(1/2)))/(R_2^2 + X_2^2))/R_2
 

S.B
% -(X_2 + ((R_2*(R_2^2 - R_1*R_2 + X_2^2))/R_1)^(1/2))/(R_2^2 + X_2^2)
% -(X_2 - ((R_2*(R_2^2 - R_1*R_2 + X_2^2))/R_1)^(1/2))/(R_2^2 + X_2^2)
 


pretty(S.X)

% /                              2                     2            \
% |                       R_1 R_2  (X_2 + #2)   R_1 X_2  (X_2 + #2) |
% |   R_2 X_1 - R_1 X_2 + ------------------- + ------------------- |
% |                                #1                    #1         |
% | - ------------------------------------------------------------- |
% |                                R_2                              |
% |                                                                 |
% |                              2                     2            |
% |                       R_1 R_2  (X_2 - #2)   R_1 X_2  (X_2 - #2) |
% |   R_2 X_1 - R_1 X_2 + ------------------- + ------------------- |
% |                                #1                    #1         |
% | - ------------------------------------------------------------- |
% \                                R_2                              /

% where

%             2      2
%    #1 == R_2  + X_2

%              /         2                2  \
%              | R_2 (R_2  - R_1 R_2 + X_2 ) |
%    #2 == sqrt| --------------------------- |
%              \             R_1             /




pretty(S.B)
% /             /         2                2  \ \
% |             | R_2 (R_2  - R_1 R_2 + X_2 ) | |
% |   X_2 + sqrt| --------------------------- | |
% |             \             R_1             / |
% | - ----------------------------------------- |
% |                     2      2                |
% |                  R_2  + X_2                 |
% |                                             |
% |             /         2                2  \ |
% |             | R_2 (R_2  - R_1 R_2 + X_2 ) | |
% |   X_2 - sqrt| --------------------------- | |
% |             \             R_1             / |
% | - ----------------------------------------- |
% |                     2      2                |
% \                  R_2  + X_2                 /
